!function(a,b,c,d){a.fn.visibility=function(c){var e,f=a(this),g=f.selector||"",h=(new Date).getTime(),i=[],j=arguments[0],k="string"==typeof j,l=[].slice.call(arguments,1);return f.each(function(){var f,m=a.extend(!0,{},a.fn.visibility.settings,c),n=(m.className,m.namespace),o=(m.error,"."+n),p="module-"+n,q=a(this),r=a(b),s=(q.offsetParent(),q.selector||"",q.data(p)),t=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame||function(a){setTimeout(a,0)},u=this;f={initialize:function(){f.verbose("Initializing visibility",m),f.reset(),f.save.position(),f.bindEvents(),f.instantiate(),setTimeout(f.checkVisibility,m.loadWait)},instantiate:function(){f.verbose("Storing instance of module",f),s=f,q.data(p,f)},destroy:function(){f.verbose("Destroying previous module"),r.off(o),q.off(o).removeData(p)},bindEvents:function(){r.on("resize",f.event.refresh).on("scroll",f.event.scroll)},event:{refresh:function(){t(f.refresh)},scroll:function(){t(f.checkVisibility)}},refresh:function(){f.save.position(),f.checkVisibility(),a.proxy(m.onRefresh,u)()},reset:function(){f.cache={screen:{},element:{}}},checkVisibility:function(){f.verbose("Updating visibility of element",f.cache.element),f.save.scroll(),f.save.direction(),f.save.screenCalculations(),f.save.elementCalculations(),f.passed(),f.passing(),f.topVisible(),f.bottomVisible(),f.topPassed(),f.bottomPassed()},passing:function(b){var c=f.get.elementCalculations(),d=f.get.screenCalculations(),e=b||m.onPassing;return b&&(f.debug("Adding callback for passing",b),m.onPassing=b),e&&c.passing?void a.proxy(e,u)(c,d):c.passing},passed:function(b,c){var e=f.get.elementCalculations();if(b!==d&&c!==d)m.onPassed[b]=c;else{if(b!==d)return f.get.pixelsPassed(b)>e.pixelsPassed;e.passing&&a.each(m.onPassed,function(a,b){(e.bottomVisible||e.pixelsPassed>f.get.pixelsPassed(a))&&b()})}},topVisible:function(b){var c=f.get.elementCalculations(),d=f.get.screenCalculations(),e=b||m.onTopVisible;return b&&(f.debug("Adding callback for top visible",b),m.onTopVisible=b),e&&c.topVisible?void a.proxy(e,u)(c,d):c.topVisible},bottomVisible:function(b){var c=f.get.elementCalculations(),d=f.get.screenCalculations(),e=b||m.onBottomVisible;return b&&(f.debug("Adding callback for bottom visible",b),m.onBottomVisible=b),e&&c.bottomVisible?void a.proxy(e,u)(c,d):c.bottomVisible},topPassed:function(b){var c=f.get.elementCalculations(),d=f.get.screenCalculations(),e=b||m.onTopPassed;return b&&(f.debug("Adding callback for top passed",b),m.onTopPassed=b),e&&c.topPassed?void a.proxy(e,u)(c,d):c.topPassed},bottomPassed:function(b){var c=f.get.elementCalculations(),d=f.get.screenCalculations(),e=b||m.onBottomPassed;return b&&(f.debug("Adding callback for bottom passed",b),m.bottomPassed=b),e&&c.bottomPassed?void a.proxy(e,u)(c,d):c.bottomPassed},save:{scroll:function(){f.cache.scroll=r.scrollTop()+m.offset},direction:function(){var a,b=f.get.scroll(),c=f.get.lastScroll();return a=b>c&&c?"down":c>b&&c?"up":"static",f.cache.direction=a,f.cache.direction},elementPosition:function(){var b=f.get.screenSize();return f.verbose("Saving element position"),a.extend(f.cache.element,{margin:{top:parseInt(q.css("margin-top"),10),bottom:parseInt(q.css("margin-bottom"),10)},fits:u.height<b.height,offset:q.offset(),width:q.outerWidth(),height:q.outerHeight()}),f.cache.element},elementCalculations:function(){var b=f.get.screenCalculations(),c=f.get.elementPosition();m.includeMargin?a.extend(f.cache.element,{top:c.offset.top-c.margin.top,bottom:c.offset.top+c.height+c.margin.bottom}):a.extend(f.cache.element,{top:c.offset.top,bottom:c.offset.top+c.height}),a.extend(f.cache.element,{topVisible:b.bottom>c.top,topPassed:b.top>c.top,bottomVisible:b.bottom>c.bottom,bottomPassed:b.top>c.bottom,pixelsPassed:0,percentagePassed:0}),a.extend(f.cache.element,{visible:f.cache.element.topVisible||f.cache.element.bottomVisible,passing:f.cache.element.topPassed&&!f.cache.element.bottomPassed,hidden:!f.cache.element.topVisible&&!f.cache.element.bottomVisible}),f.cache.element.passing&&(f.cache.element.pixelsPassed=b.top-c.top,f.cache.element.percentagePassed=(b.top-c.top)/c.height),f.verbose("Updated element calculations",f.cache.element)},screenCalculations:function(){var b=r.scrollTop();return f.cache.scroll===d&&(f.cache.scroll=r.scrollTop()),f.save.direction(),a.extend(f.cache.screen,{top:b+m.offset,bottom:b+m.offset+f.cache.screen.height}),f.cache.screen},screenSize:function(){f.verbose("Saving window position"),f.cache.screen={height:r.height()}},position:function(){f.save.screenSize(),f.save.elementPosition()}},get:{pixelsPassed:function(a){var b=f.get.elementCalculations();return a.search("%")>-1?b.height*(parseInt(a,10)/100):parseInt(a,10)},direction:function(){return f.cache.direction===d&&f.save.direction(),f.cache.direction},elementPosition:function(){return f.cache.element===d&&f.save.elementPosition(),f.cache.element},elementCalculations:function(){return f.cache.element===d&&f.save.elementCalculations(),f.cache.element},screenCalculations:function(){return f.cache.screen===d&&f.save.screenCalculations(),f.cache.screen},screenSize:function(){return f.cache.screen===d&&f.save.screenSize(),f.cache.screen},scroll:function(){return f.cache.scroll===d&&f.save.scroll(),f.cache.scroll},lastScroll:function(){return f.cache.screen===d?(f.debug("First scroll event, no last scroll could be found"),!1):f.cache.screen.top}},setting:function(b,c){if(a.isPlainObject(b))a.extend(!0,m,b);else{if(c===d)return m[b];m[b]=c}},internal:function(b,c){if(a.isPlainObject(b))a.extend(!0,f,b);else{if(c===d)return f[b];f[b]=c}},debug:function(){m.debug&&(m.performance?f.performance.log(arguments):(f.debug=Function.prototype.bind.call(console.info,console,m.name+":"),f.debug.apply(console,arguments)))},verbose:function(){m.verbose&&m.debug&&(m.performance?f.performance.log(arguments):(f.verbose=Function.prototype.bind.call(console.info,console,m.name+":"),f.verbose.apply(console,arguments)))},error:function(){f.error=Function.prototype.bind.call(console.error,console,m.name+":"),f.error.apply(console,arguments)},performance:{log:function(a){var b,c,d;m.performance&&(b=(new Date).getTime(),d=h||b,c=b-d,h=b,i.push({Element:u,Name:a[0],Arguments:[].slice.call(a,1)||"","Execution Time":c})),clearTimeout(f.performance.timer),f.performance.timer=setTimeout(f.performance.display,100)},display:function(){var b=m.name+":",c=0;h=!1,clearTimeout(f.performance.timer),a.each(i,function(a,b){c+=b["Execution Time"]}),b+=" "+c+"ms",g&&(b+=" '"+g+"'"),(console.group!==d||console.table!==d)&&i.length>0&&(console.groupCollapsed(b),console.table?console.table(i):a.each(i,function(a,b){console.log(b.Name+": "+b["Execution Time"]+"ms")}),console.groupEnd()),i=[]}},invoke:function(b,c,f){var g,h,i,j=s;return c=c||l,f=u||f,"string"==typeof b&&j!==d&&(b=b.split(/[\. ]/),g=b.length-1,a.each(b,function(c,e){var f=c!=g?e+b[c+1].charAt(0).toUpperCase()+b[c+1].slice(1):b;if(a.isPlainObject(j[f])&&c!=g)j=j[f];else{if(j[f]!==d)return h=j[f],!1;if(!a.isPlainObject(j[e])||c==g)return j[e]!==d?(h=j[e],!1):!1;j=j[e]}})),a.isFunction(h)?i=h.apply(f,c):h!==d&&(i=h),a.isArray(e)?e.push(i):e!==d?e=[e,i]:i!==d&&(e=i),h}},k?(s===d&&f.initialize(),f.invoke(j)):(s!==d&&f.destroy(),f.initialize())}),e!==d?e:this},a.fn.visibility.settings={name:"Visibility",namespace:"visibility",verbose:!1,debug:!1,performance:!0,loadWait:1e3,watch:!0,offset:0,includeMargin:!1,onPassed:{},onPassing:!1,onTopVisible:!1,onBottomVisible:!1,onTopPassed:!1,onBottomPassed:!1,onRefresh:function(){},onScroll:function(){},watchedProperties:["offsetWidth","offsetHeight","top","left"],error:{method:"The method you called is not defined."}}}(jQuery,window,document);