!function(a){a.address=function(){var x,W,b=function(b){var c=a.extend(a.Event(b),function(){for(var b={},c=a.address.parameterNames(),d=0,e=c.length;e>d;d++)b[c[d]]=a.address.parameter(c[d]);return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:c,parameters:b,queryString:a.address.queryString()}}.call(a.address));return a(a.address).trigger(c),c},c=function(a){return Array.prototype.slice.call(a)},d=function(){return a().bind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},e=function(){return a().unbind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},f=function(){return P.pushState&&I.state!==x},g=function(){return("/"+Q.pathname.replace(new RegExp(I.state),"")+Q.search+(h()?"#"+h():"")).replace(T,"/")},h=function(){var a=Q.href.indexOf("#");return-1!=a?Q.href.substr(a+1):""},i=function(){return f()?g():h()},j=function(){try{return top.document!==x&&top.document.title!==x?top:window}catch(a){return window}},k=function(){return"javascript"},l=function(a){return a=a.toString(),(I.strict&&"/"!=a.substr(0,1)?"/":"")+a},m=function(a,b){return parseInt(a.css(b),10)},n=function(){if(!_){var a=i(),b=decodeURI(eb)!=decodeURI(a);b&&(M&&7>K?Q.reload():(M&&!V&&I.history&&S(q,50),eb=a,o(H)))}},o=function(a){return"null"!==I.tracker&&I.tracker!==y&&S(p,10),b(D).isDefaultPrevented()||b(a?E:F).isDefaultPrevented()},p=function(){if("null"!==I.tracker&&I.tracker!==y){var b=a.isFunction(I.tracker)?I.tracker:N[I.tracker],c=(Q.pathname+Q.search+(a.address&&!f()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");a.isFunction(b)?b(c):a.isFunction(N.urchinTracker)?N.urchinTracker(c):N.pageTracker!==x&&a.isFunction(N.pageTracker._trackPageview)?N.pageTracker._trackPageview(c):N._gaq!==x&&a.isFunction(N._gaq.push)&&N._gaq.push(["_trackPageview",decodeURI(c)])}},q=function(){var a=k()+":"+H+";document.open();document.writeln('<html><head><title>"+O.title.replace(/\'/g,"\\'")+"</title><script>var "+z+' = "'+encodeURIComponent(i()).replace(/\'/g,"\\'")+(O.domain!=Q.hostname?'";document.domain="'+O.domain:"")+'";</'+"script></head></html>');document.close();";7>K?W.src=a:W.contentWindow.location.replace(a)},r=function(){if(Y&&-1!=Z){var a,b,c=Y.substr(Z+1).split("&");for(a=0;a<c.length;a++)b=c[a].split("="),/^(autoUpdate|history|strict|wrap)$/.test(b[0])&&(I[b[0]]=isNaN(b[1])?/^(true|yes)$/i.test(b[1]):0!==parseInt(b[1],10)),/^(state|tracker)$/.test(b[0])&&(I[b[0]]=b[1]);Y=y}eb=i()},s=function(){if(!ab){if(ab=G,r(),a('a[rel*="address:"]').address(),I.wrap){var c=a("body");a("body > *").wrapAll('<div style="padding:'+(m(c,"marginTop")+m(c,"paddingTop"))+"px "+(m(c,"marginRight")+m(c,"paddingRight"))+"px "+(m(c,"marginBottom")+m(c,"paddingBottom"))+"px "+(m(c,"marginLeft")+m(c,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+z+'" style="height:100%;overflow:auto;position:relative;'+(L&&!window.statusbar.visible?"resize:both;":"")+'" />'),a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),L&&a('<style type="text/css" />').appendTo("head").text("#"+z+"::-webkit-resizer { background-color: #fff; }")}if(M&&!V){var e=O.getElementsByTagName("frameset")[0];W=O.createElement((e?"":"i")+"frame"),W.src=k()+":"+H,e?(e.insertAdjacentElement("beforeEnd",W),e[e.cols?"cols":"rows"]+=",0",W.noResize=G,W.frameBorder=W.frameSpacing=0):(W.style.display="none",W.style.width=W.style.height=0,W.tabIndex=-1,O.body.insertAdjacentElement("afterBegin",W)),S(function(){a(W).bind("load",function(){var a=W.contentWindow;eb=a[z]!==x?a[z]:"",eb!=i()&&(o(H),Q.hash=eb)}),W.contentWindow[z]===x&&q()},50)}S(function(){b("init"),o(H)},1),f()||(M&&K>7||!M&&V?N.addEventListener?N.addEventListener(B,n,H):N.attachEvent&&N.attachEvent("on"+B,n):R(n,50)),"state"in window.history&&a(window).trigger("popstate")}},t=function(){decodeURI(eb)!=decodeURI(i())&&(eb=i(),o(H))},u=function(){N.removeEventListener?N.removeEventListener(B,n,H):N.detachEvent&&N.detachEvent("on"+B,n)},v=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},w=function(){var a={},b=v(navigator.userAgent);return b.browser&&(a[b.browser]=!0,a.version=b.version),a.chrome?a.webkit=!0:a.webkit&&(a.safari=!0),a},y=null,z="jQueryAddress",A="string",B="hashchange",C="init",D="change",E="internalChange",F="externalChange",G=!0,H=!1,I={autoUpdate:G,history:G,strict:G,wrap:H},J=w(),K=parseFloat(J.version),L=J.webkit||J.safari,M=J.msie,N=j(),O=N.document,P=N.history,Q=N.location,R=setInterval,S=setTimeout,T=/\/{2,9}/g,U=navigator.userAgent,V="on"+B in N,Y=a("script:last").attr("src"),Z=Y?Y.indexOf("?"):-1,$=O.title,_=H,ab=H,bb=G,cb=H,eb=i();if(M){K=parseFloat(U.substr(U.indexOf("MSIE")+4)),O.documentMode&&O.documentMode!=K&&(K=8!=O.documentMode?7:8);var fb=O.onpropertychange;O.onpropertychange=function(){fb&&fb.call(O),O.title!=$&&-1!=O.title.indexOf("#"+i())&&(O.title=$)}}if(P.navigationMode&&(P.navigationMode="compatible"),"complete"==document.readyState)var gb=setInterval(function(){a.address&&(s(),clearInterval(gb))},50);else r(),a(s);return a(window).bind("popstate",t).bind("unload",u),{bind:function(){return d.apply(this,c(arguments))},unbind:function(){return e.apply(this,c(arguments))},init:function(){return d.apply(this,[C].concat(c(arguments)))},change:function(){return d.apply(this,[D].concat(c(arguments)))},internalChange:function(){return d.apply(this,[E].concat(c(arguments)))},externalChange:function(){return d.apply(this,[F].concat(c(arguments)))},baseURL:function(){var a=Q.href;return-1!=a.indexOf("#")&&(a=a.substr(0,a.indexOf("#"))),/\/$/.test(a)&&(a=a.substr(0,a.length-1)),a},autoUpdate:function(a){return a!==x?(I.autoUpdate=a,this):I.autoUpdate},history:function(a){return a!==x?(I.history=a,this):I.history},state:function(a){if(a!==x){I.state=a;var b=g();return I.state!==x&&(P.pushState?"/#/"==b.substr(0,3)&&Q.replace(I.state.replace(/^\/$/,"")+b.substr(2)):"/"!=b&&b.replace(/^\/#/,"")!=h()&&S(function(){Q.replace(I.state.replace(/^\/$/,"")+"/#"+b)},1)),this}return I.state},strict:function(a){return a!==x?(I.strict=a,this):I.strict},tracker:function(a){return a!==x?(I.tracker=a,this):I.tracker},wrap:function(a){return a!==x?(I.wrap=a,this):I.wrap},update:function(){return cb=G,this.value(eb),cb=H,this},title:function(a){return a!==x?(S(function(){$=O.title=a,bb&&W&&W.contentWindow&&W.contentWindow.document&&(W.contentWindow.document.title=a,bb=H)},50),this):O.title},value:function(a){if(a!==x){if(a=l(a),"/"==a&&(a=""),eb==a&&!cb)return;if(eb=a,I.autoUpdate||cb){if(o(G))return this;f()?P[I.history?"pushState":"replaceState"]({},"",I.state.replace(/\/$/,"")+(""===eb?"/":eb)):(_=G,L?I.history?Q.hash="#"+eb:Q.replace("#"+eb):eb!=i()&&(I.history?Q.hash="#"+eb:Q.replace("#"+eb)),M&&!V&&I.history&&S(q,50),L?S(function(){_=H},1):_=H)}return this}return l(eb)},path:function(a){if(a!==x){var b=this.queryString(),c=this.hash();return this.value(a+(b?"?"+b:"")+(c?"#"+c:"")),this}return l(eb).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(T,"/").split("/");return("/"==a.substr(0,1)||0===a.length)&&b.splice(0,1),"/"==a.substr(a.length-1,1)&&b.splice(b.length-1,1),b},queryString:function(a){if(a!==x){var b=this.hash();return this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:"")),this}var c=eb.split("?");return c.slice(1,c.length).join("?").split("#")[0]},parameter:function(b,c,d){var e,f;if(c!==x){var g=this.parameterNames();for(f=[],c=c===x||c===y?"":c.toString(),e=0;e<g.length;e++){var h=g[e],i=this.parameter(h);typeof i==A&&(i=[i]),h==b&&(i=c===y||""===c?[]:d?i.concat([c]):[c]);for(var j=0;j<i.length;j++)f.push(h+"="+i[j])}return-1==a.inArray(b,g)&&c!==y&&""!==c&&f.push(b+"="+c),this.queryString(f.join("&")),this}if(c=this.queryString()){var k=[];for(f=c.split("&"),e=0;e<f.length;e++){var l=f[e].split("=");l[0]==b&&k.push(l.slice(1).join("="))}if(0!==k.length)return 1!=k.length?k:k[0]}},parameterNames:function(){var b=this.queryString(),c=[];if(b&&-1!=b.indexOf("="))for(var d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=")[0];-1==a.inArray(f,c)&&c.push(f)}return c},hash:function(a){if(a!==x)return this.value(eb.split("#")[0]+(a?"#"+a:"")),this;var b=eb.split("#");return b.slice(1,b.length).join("#")}}}(),a.fn.address=function(b){return this.data("address")||this.on("click",function(c){if(c.shiftKey||c.ctrlKey||c.metaKey||2==c.which)return!0;var d=c.currentTarget;if(a(d).is("a")){c.preventDefault();var e=b?b.call(d):/address:/.test(a(d).attr("rel"))?a(d).attr("rel").split("address:")[1].split(" ")[0]:void 0===a.address.state()||/^\/?$/.test(a.address.state())?a(d).attr("href").replace(/^(#\!?|\.)/,""):a(d).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),"");a.address.value(e)}}).on("submit",function(c){var d=c.currentTarget;if(a(d).is("form")){c.preventDefault();var e=a(d).attr("action"),f=b?b.call(d):(-1!=e.indexOf("?")?e.replace(/&$/,""):e+"?")+a(d).serialize();a.address.value(f)}}).data("address",!0),this}}(jQuery);